<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Pinguin Lompat Es</title>
    <style>
        :root {
            --primary: #4A90E2;
            --secondary: #FFC107;
            --bg: #E3F2FD;
            --text: #333;
        }
        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            text-align: center;
            margin: 0;
            padding: 20px;
            overflow: hidden; /* Mencegah scroll saat main */
        }
        h1 {
            color: var(--primary);
            margin-bottom: 5px;
        }
        p {
            color: #555;
            margin-bottom: 20px;
        }
        /* Area Game */
        canvas {
            background-color: #B3E5FC;
            border: 4px solid white;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            max-width: 100%;
            cursor: pointer;
        }
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
            z-index: 1000;
            width: 300px;
            border: 5px solid var(--primary);
        }
        .modal-title {
            font-size: 1.5em;
            color: #E53935;
            margin-top: 0;
        }
        .math-question {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary);
            margin: 20px 0;
        }
        input[type="number"] {
            width: 80%;
            padding: 10px;
            font-size: 1.5em;
            text-align: center;
            border: 2px solid var(--primary);
            border-radius: 10px;
            margin-bottom: 20px;
            font-family: inherit;
        }
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1.2em;
            border-radius: 10px;
            cursor: pointer;
            font-family: inherit;
            margin: 5px;
            width: 90%;
            transition: 0.2s;
        }
        .btn-secondary {
            background: #9E9E9E;
        }
        .btn-success {
            background: #4CAF50;
        }
        .btn:hover {
            opacity: 0.9;
            transform: scale(1.02);
        }
        #overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 999;
        }
        .score-board {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <h1>üêß Petualangan Pingu!</h1>
    <p>Ketuk layar atau tekan SPASI untuk melompat.</p>

    <div class="score-board">Skor: <span id="score">0</span></div>
    
    <canvas id="gameCanvas" width="800" height="300"></canvas>

    <div id="overlay"></div>

    <div id="start-modal" class="modal">
        <h2 style="color: var(--primary); margin-top: 0;">Siap Bermain? üéÆ</h2>
        <p>Bantu Pingu melompati rintangan es sambil menunggu waktu berbuka puasa!</p>
        <button class="btn btn-success" onclick="startGame()">‚ñ∂Ô∏è Mulai Game</button>
        <button class="btn btn-secondary" onclick="window.location.href='index.html'">Kembali ke Tracker Puasa</button>
    </div>

    <div id="math-modal" class="modal">
        <h2 class="modal-title">Yah, Nabrak Es! üßä</h2>
        <p>Mau main lagi sekarang? Jawab soal matematika ini dulu ya!</p>
        <div class="math-question" id="question-text">5 + 3 = ?</div>
        <input type="number" id="math-answer" placeholder="Jawab...">
        <br>
        <button class="btn" onclick="checkMath()">Cek Jawaban!</button>
        <button class="btn btn-secondary" onclick="comeBackTomorrow()">Besok Aja Deh</button>
        <p id="math-feedback" style="color: red; display: none; margin-top: 10px;">Jawaban kurang tepat, coba lagi!</p>
    </div>

    <div id="locked-modal" class="modal">
        <h2 style="color: var(--primary); margin-top: 0;">Sampai Jumpa Besok! üåô</h2>
        <p>Pingu mau istirahat dulu ya. Silakan kembali besok untuk bermain lagi!</p>
        <button class="btn btn-secondary" onclick="window.location.href='index.html'">Kembali ke Tracker Puasa</button>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        
        // Game Variables
        let frames = 0;
        let score = 0;
        let isGameOver = false;
        let gameSpeed = 5;
        let animationId;

        // Cek status hari ini di localStorage
        let todayDate = new Date().toDateString();
        let lockedDate = localStorage.getItem('pinguLockedDate');

        // Pinguin Object
        const pinguin = {
            x: 50,
            y: 200,
            width: 40,
            height: 40,
            dy: 0,
            jumpForce: -12,
            gravity: 0.6,
            grounded: false,
            
            draw() {
                ctx.font = "40px Arial";
                ctx.textBaseline = "top";
                ctx.fillText("üêß", this.x, this.y);
            },
            
            jump() {
                if (this.grounded && !isGameOver) {
                    this.dy = this.jumpForce;
                    this.grounded = false;
                }
            },
            
            update() {
                this.y += this.dy;
                // Gravitasi
                if (this.y + this.height < 250) {
                    this.dy += this.gravity;
                    this.grounded = false;
                } else {
                    this.dy = 0;
                    this.y = 250 - this.height; // Batas tanah
                    this.grounded = true;
                }
                this.draw();
            }
        };

        // Rintangan Balok Es
        const obstacles = [];
        
        function handleObstacles() {
            // Tambah rintangan baru setiap 100 frame
            if (frames % 100 === 0) {
                let obsHeight = Math.random() * (60 - 30) + 30; // tinggi acak
                obstacles.push({
                    x: canvas.width,
                    y: 250 - obsHeight,
                    width: 30,
                    height: obsHeight
                });
            }
            
            for (let i = 0; i < obstacles.length; i++) {
                let obs = obstacles[i];
                obs.x -= gameSpeed;
                
                // Gambar rintangan es
                ctx.fillStyle = "white";
                ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
                ctx.strokeStyle = "#81D4FA";
                ctx.lineWidth = 3;
                ctx.strokeRect(obs.x, obs.y, obs.width, obs.height);
                
                // Deteksi Tabrakan (Collision)
                if (
                    pinguin.x < obs.x + obs.width &&
                    pinguin.x + pinguin.width - 10 > obs.x &&
                    pinguin.y < obs.y + obs.height &&
                    pinguin.y + pinguin.height > obs.y
                ) {
                    isGameOver = true;
                }
                
                // Hapus rintangan yang sudah lewat dan tambah skor
                if (obs.x + obs.width < 0) {
                    obstacles.splice(i, 1);
                    score += 10;
                    document.getElementById('score').innerText = score;
                    i--;
                }
            }
        }

        // Garis Tanah
        function drawGround() {
            ctx.fillStyle = "#E0F7FA";
            ctx.fillRect(0, 250, canvas.width, 50);
            ctx.strokeStyle = "#4DD0E1";
            ctx.beginPath();
            ctx.moveTo(0, 250);
            ctx.lineTo(canvas.width, 250);
            ctx.stroke();
        }

        // Main Game Loop
        function animate() {
            if (isGameOver) {
                cancelAnimationFrame(animationId);
                triggerMathChallenge();
                return;
            }
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawGround();
            pinguin.update();
            handleObstacles();
            
            // Tingkatkan kecepatan perlahan
            if (frames % 500 === 0 && gameSpeed < 10) gameSpeed += 0.5;
            
            frames++;
            animationId = requestAnimationFrame(animate);
        }

        // --- KONTROL TOMBOL & SENTUHAN ---
        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space') pinguin.jump();
        });
        canvas.addEventListener('mousedown', () => pinguin.jump());
        canvas.addEventListener('touchstart', (e) => {
            if(e.target === canvas) {
                e.preventDefault();
                pinguin.jump();
            }
        }, {passive: false});

        // --- FUNGSI ALUR GAME (START, MATH, RESTART) ---
        
        function startGame() {
            document.getElementById('start-modal').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
            animate();
        }

        let currentAnswer = 0;

        function triggerMathChallenge() {
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('math-modal').style.display = 'block';
            document.getElementById('math-feedback').style.display = 'none';
            document.getElementById('math-answer').value = '';
            
            let num1 = Math.floor(Math.random() * 10) + 1;
            let num2 = Math.floor(Math.random() * 10) + 1;
            currentAnswer = num1 + num2;
            
            document.getElementById('question-text').innerText = `${num1} + ${num2} = ?`;
        }

        function checkMath() {
            let userAnswer = parseInt(document.getElementById('math-answer').value);
            if (userAnswer === currentAnswer) {
                document.getElementById('math-modal').style.display = 'none';
                document.getElementById('overlay').style.display = 'none';
                restartGame();
            } else {
                document.getElementById('math-feedback').style.display = 'block';
            }
        }

        function comeBackTomorrow() {
            localStorage.setItem('pinguLockedDate', todayDate);
            document.getElementById('math-modal').style.display = 'none';
            document.getElementById('locked-modal').style.display = 'block';
        }

        function restartGame() {
            obstacles.length = 0;
            pinguin.y = 200;
            pinguin.dy = 0;
            frames = 0;
            score = 0;
            gameSpeed = 5;
            document.getElementById('score').innerText = score;
            isGameOver = false;
            animate();
        }

        // --- SAAT HALAMAN PERTAMA KALI DIBUKA ---
        window.onload = () => {
            // Gambar layar latar belakang (tanah dan pinguin) agar canvas tidak kosong
            drawGround();
            pinguin.draw();
            
            document.getElementById('overlay').style.display = 'block';
            
            if (lockedDate === todayDate) {
                // Jika sudah nyerah hari ini, langsung tampilkan modal terkunci
                document.getElementById('locked-modal').style.display = 'block';
            } else {
                // Jika belum terkunci, tampilkan layar start
                document.getElementById('start-modal').style.display = 'block';
            }
        };

    </script>
</body>
</html>
